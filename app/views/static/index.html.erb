<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>LA Rental price heatmap</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdacxIPLBmGeowW3ICo1quEftRP7DbA2k&libraries=visualization"></script>

  <script>
  var map, heatmap, myData;
  myData = httpGet("http://localhost:3000/neighborhoods.json");
  myData = JSON.parse(myData);

  function initialize() {
    var mapCenter = new google.maps.LatLng(-34.397, 150.644);
    var mapOptions = {
      zoom: 10
      ,center: mapCenter
      ,mapTypeId: google.maps.MapTypeId.SATELLITE
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    var markerCoords = [];

    myData.forEach(function( each,count ) {
// Load up an array with object literal lat lng and weight values
markerCoords.push({ lat: parseFloat( each.Latitude ),
  lng: parseFloat( each.Longitude ),
  weight: parseFloat( each.AvgRentPrice )});
map.setCenter (markerCoords[count] );
/*
var marker = new google.maps.Marker({   
map: map, 
position: markerCoords[count]
});// var marker
    */
});// myData.forEach

// Trying to convert myData to the Latlng objects google uses..throws errors 
var testData2=[];
/*
myData.forEach(function(each, count){
testData2.push(new google.maps.Latlng(each.Latitude, each.Longitude));
});
*/
for (i = 0; i < myData.length; i++){
  testData2[i] = {
    location: new google.maps.LatLng(myData[i].Latitude, myData[i].Longitude), 
    weight: parseFloat(myData[i].AvgRentPrice)
  };
  console.log(myData[i]);
}

// Just to see if the heatmap works at all...it does.
var testData = [
new google.maps.LatLng(37.782551, -122.445368),
new google.maps.LatLng(37.782745, -122.444586),
new google.maps.LatLng(37.782842, -122.443688),
new google.maps.LatLng(37.782919, -122.442815),
new google.maps.LatLng(37.782992, -122.442112),
new google.maps.LatLng(37.783100, -122.441461),
new google.maps.LatLng(37.783206, -122.440829),
new google.maps.LatLng(37.783273, -122.440324),
new google.maps.LatLng(37.783316, -122.440023),
new google.maps.LatLng(37.783357, -122.439794),
new google.maps.LatLng(37.783371, -122.439687)
];
//map.setCenter (myData[0]);

heatmap = new google.maps.visualization.HeatmapLayer({ data: testData2 });
heatmap.setMap(map);
}// Initialize


function httpGet(targetURL) {
  var xmlHttp = null;
  xmlHttp = new XMLHttpRequest();
  xmlHttp.open( "GET", targetURL, false );
  xmlHttp.send( null );
  return xmlHttp.responseText;
}

function cycleRadius(newRadius) {
  heatmap.set('radius', newRadius );
}

function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body>
  <div id="panel">
    <input type="button" value="Toggle Heatmap" onclick="toggleHeatmap()">
    <input type="number" name="Radius Spinner" onchange="cycleRadius(parseFloat(this.value))">
  </div>
  <div id="map-canvas"></div>
</body>
</html>