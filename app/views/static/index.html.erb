<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>LA Rental price heatmap</title>
  
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdacxIPLBmGeowW3ICo1quEftRP7DbA2k"></script>
  <script>
  var map, heatmap, myData, myGeoJSON;
  myData = httpGet("http://localhost:3000/neighborhoods.json");
  myData = JSON.parse(myData);

  function initialize() {
    var mapCenter = new google.maps.LatLng(-34.397, 150.644);
    var mapOptions = {
      zoom: 10,
      center: mapCenter,
      mapTypeId: google.maps.MapTypeId.SATELLITE
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    var markerCoords = [];

    // Load up an array with object literal lat lng and weight values
    myData.forEach(function( each,count ) {
      markerCoords.push({ lat: parseFloat( each.Latitude ),
        lng: parseFloat( each.Longitude ),
        weight: parseFloat( each.AvgRentPrice )});
      map.setCenter (markerCoords[count] );
    });// myData.forEach

    var testData2=[];

  for (i = 0; i < myData.length; i++){
    testData2[i] = {
      location: new google.maps.LatLng(myData[i].Latitude, myData[i].Longitude), 
      weight: parseFloat(myData[i].AvgRentPrice)
  };
}

// Just to see if the heatmap works at all...it does.
var testData = [
new google.maps.LatLng(37.782551, -122.445368),
new google.maps.LatLng(37.782745, -122.444586),
new google.maps.LatLng(37.782842, -122.443688),
new google.maps.LatLng(37.782919, -122.442815),
new google.maps.LatLng(37.782992, -122.442112),
new google.maps.LatLng(37.783100, -122.441461),
new google.maps.LatLng(37.783206, -122.440829),
new google.maps.LatLng(37.783273, -122.440324),
new google.maps.LatLng(37.783316, -122.440023),
new google.maps.LatLng(37.783357, -122.439794),
new google.maps.LatLng(37.783371, -122.439687)
];

/*
heatmap = new google.maps.visualization.HeatmapLayer({ data: testData2 });
heatmap.setMap(map);
*/

/*
d3.json("zillow.json", function(error, json) {
  if (error) return console.warn(error);
  myGeoJSON = json;
});
*/
map.data.addGeoJson(myGJ);
var featureStyle = {
  strokeColor: '#ff3333',
  strokeWeight: 0
}
console.log(myGJ);
}// Initialize


function httpGet(targetURL) {
  var xmlHttp = null;
  xmlHttp = new XMLHttpRequest();
  xmlHttp.open( "GET", targetURL, false );
  xmlHttp.send( null );
  return xmlHttp.responseText;
}

function cycleRadius(newRadius) {
  heatmap.set('radius', newRadius );
}

function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body>
  <div id="panel">
    <input type="button" value="Toggle Heatmap" onclick="toggleHeatmap()">
    <input type="number" name="Radius Spinner" onchange="cycleRadius(parseFloat(this.value))">
  </div>
  <div id="map-canvas"></div>
</body>
</html>